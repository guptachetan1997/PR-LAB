import numpy as np
import matplotlib.pyplot as plt
data_x = np.linspace(1.0, 10.0, 100)[:, np.newaxis]
data_y = np.sin(data_x) + 0.1*np.power(data_x, 2) + 0.5*np.random.randn(100,1)
data_x /= np.max(data_x)
plt.scatter(data_x,data_y)
plt.show() 
data_x = np.hstack((np.ones_like(data_x), data_x))
order = np.random.permutation(len(data_x))
portion = 20
test_x = data_x [order[:portion]]
test_y = data_y [order[:portion]]
train_x = data_x [order[:portion]]
train_y = data_y [order[:portion]]
 
def get_gradient(w, x, y):
   y_estimate = x.dot(w).flatten()
   error = (y.flatten() - y_estimate)
   gradient = -(1.0/len(x)) * error.dot(x)
   return gradient, np.power(error, 2)
w = np.random.randn(2)
alpha = 0.5
tolerance = 1e-9
iterations = 1
while True:
   gradient, error = get_gradient(w, train_x, train_y)
   new_w = w - alpha * gradient
   if np.sum(abs(new_w - w)) < tolerance:
       print ("Converged")
       break
   if iterations % 100 == 0:
       print (iterations, error)
   iterations += 1
   w = new_w
 
X=[]
Y=[]
for x in data_x:
   X.append(x[1])
   Y.append(w[0]+w[1]*x[1])
plt.scatter(data_x[:,1], data_y)
plt.plot(X,Y)
plt.show()

# OUTPUT
# 100 [ 2.04757775  0.82757752  1.05573888  3.31082156  0.24009469  0.01148393
#   3.3893371   2.71662521  1.44423792  0.08944913  1.56739913  1.68373308
#   0.01632486  0.72707627  0.48629728  1.19230672  1.70197508  3.49103225
#   2.8536881   0.48004513]
# 200 [  1.81705665e+00   3.90350664e-01   7.65621664e-01   1.80454422e+00
#    1.53919385e-01   4.92465230e-02   2.88728049e+00   1.80777092e+00
#    3.34520046e-01   3.39823796e-03   8.44270922e-01   1.37004114e+00
#    1.16533816e-03   4.64362548e-01   1.43602850e-01   7.49708942e-01
#    3.56407597e+00   6.52657822e+00   1.96088665e+00   3.41646974e-01]
# 300 [  1.77278600e+00   3.22656786e-01   7.13391542e-01   1.55870020e+00
#    1.39033765e-01   8.26333006e-02   2.79208656e+00   1.64877671e+00
#    2.06309809e-01   1.06825684e-04   7.26745218e-01   1.31141972e+00
#    2.39874439e-04   4.19040575e-01   9.95604376e-02   6.73761146e-01
#    4.01622033e+00   7.24367971e+00   1.80300675e+00   3.16885258e-01]
# 400 [  1.76403356e+00   3.09943069e-01   7.03208907e-01   1.51188300e+00
#    1.36159297e-01   9.03092440e-02   2.77331679e+00   1.61798276e+00
#    1.84455644e-01   6.13759196e-07   7.04388381e-01   1.29989682e+00
#    1.38613356e-04   4.10291401e-01   9.17488497e-02   6.59118446e-01
#    4.10950016e+00   7.39097173e+00   1.77235211e+00   3.12064555e-01]
# 500 [  1.76229288e+00   3.07441322e-01   7.01189514e-01   1.50264340e+00
#    1.35590358e-01   9.18788127e-02   2.76958587e+00   1.61188402e+00
#    1.80248900e-01   1.25248279e-06   6.99977152e-01   1.29760781e+00
#    1.21740025e-04   4.08559800e-01   9.02310783e-02   6.56221186e-01
#    4.12820713e+00   7.42048577e+00   1.76627784e+00   3.11108801e-01]
# 600 [  1.76194628e+00   3.06944246e-01   7.00787646e-01   1.50080648e+00
#    1.35477181e-01   9.21930476e-02   2.76884306e+00   1.61067067e+00
#    1.79416814e-01   2.24427360e-06   6.99100196e-01   1.29715214e+00
#    1.18509999e-04   4.08215345e-01   8.99302867e-02   6.55644884e-01
#    4.13193818e+00   7.42637128e+00   1.76506924e+00   3.10918612e-01]
# 700 [  1.76187725e+00   3.06845288e-01   7.00707618e-01   1.50044074e+00
#    1.35454645e-01   9.22556997e-02   2.76869512e+00   1.61042906e+00
#    1.79251312e-01   2.47611277e-06   6.98925594e-01   1.29706139e+00
#    1.17871842e-04   4.08146755e-01   8.98704363e-02   6.55530128e-01
#    4.13268151e+00   7.42754381e+00   1.76482856e+00   3.10880739e-01]
# 800 [  1.76186350e+00   3.06825580e-01   7.00691679e-01   1.50036790e+00
#    1.35450156e-01   9.22681810e-02   2.76866566e+00   1.61038094e+00
#    1.79218358e-01   2.52365018e-06   6.98890820e-01   1.29704331e+00
#    1.17744943e-04   4.08133094e-01   8.98585179e-02   6.55507273e-01
#    4.13282958e+00   7.42777736e+00   1.76478063e+00   3.10873195e-01]
# 900 [  1.76186076e+00   3.06821655e-01   7.00688504e-01   1.50035339e+00
#    1.35449262e-01   9.22706671e-02   2.76865979e+00   1.61037135e+00
#    1.79211794e-01   2.53317245e-06   6.98883894e-01   1.29703971e+00
#    1.17719676e-04   4.08130373e-01   8.98561442e-02   6.55502721e-01
#    4.13285907e+00   7.42782388e+00   1.76477108e+00   3.10871693e-01]
# 1000 [  1.76186021e+00   3.06820873e-01   7.00687872e-01   1.50035050e+00
#    1.35449084e-01   9.22711623e-02   2.76865862e+00   1.61036944e+00
#    1.79210487e-01   2.53507120e-06   6.98882514e-01   1.29703899e+00
#    1.17714643e-04   4.08129831e-01   8.98556714e-02   6.55501814e-01
#    4.13286494e+00   7.42783314e+00   1.76476918e+00   3.10871394e-01]
# 1100 [  1.76186011e+00   3.06820717e-01   7.00687746e-01   1.50034993e+00
#    1.35449049e-01   9.22712609e-02   2.76865839e+00   1.61036906e+00
#    1.79210227e-01   2.53544947e-06   6.98882239e-01   1.29703885e+00
#    1.17713641e-04   4.08129723e-01   8.98555772e-02   6.55501634e-01
#    4.13286611e+00   7.42783499e+00   1.76476880e+00   3.10871334e-01]
# Converged